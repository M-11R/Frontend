'use client'

import { useState, useEffect, CSSProperties } from 'react';
import { useRouter } from 'next/navigation';
import axios from 'axios';
import { getUnivId } from '../util/storage';
import Image from 'next/image';
import agileImg from '../img/agile.png';
import waterfallImg from '../img/waterfall.png';


export function Modal({ isOpen, closeModal, children }: { isOpen: boolean; closeModal: () => void; children?: React.ReactNode }) {
    return (
        isOpen && (
        <div style={{
            position: 'fixed', top: '0', left: '0',
            width: '100%', height: '100%',
            background: 'rgba(0, 0, 0, 0.3)',
            display: 'flex', justifyContent: 'center', alignItems: 'center',
            zIndex: 9999
        }}>
            <div style={{
                background: '#ffffff',
                padding: '30px',
                borderRadius: '12px',
                boxShadow: '0 4px 20px rgba(0,0,0,0.2)',
                maxWidth: '800px',
                width: '90%',
                height: '90vh',
                overflowY: 'auto',
                position: 'relative'
            }}>
                <div style={{width: '100%', display: 'flex'}}>
                    <div style={{marginLeft: 'auto'}}>
                        <button onClick={closeModal} style={{
                            fontSize: '18px',
                            background: 'transparent',
                            border: 'none',
                            cursor: 'pointer'
                        }}>‚ùå</button>
                    </div>
                </div>
                {children}
            </div>
        </div>
        )
    );
}


type draft = {
    leader_univ_id: number
    new: boolean // ÏÉàÎ°ú ÎßåÎì† ÌîÑÎ°úÏ†ùÌä∏Ïù∏ÏßÄ, ÏïÑÎãàÎ©¥ ÏàòÏ†ïÎ≥∏Ïù∏ÏßÄ ÌôïÏù∏ÌïòÎäî Î≥ÄÏàò; ÏÉàÎ°ú ÎßåÎì§Í≥† Ï≤òÏùå Ï†ÄÏû•ÌïúÎã§Î©¥ TrueÎ°ú
    draft_id: number | null

    pname: string | null
    pdetails: string | null
    psize: number | null
    pperiod: string | null
    pmm: number | null
    univ_id: string | null // ÌåÄÏõêÏùò ÌïôÎ≤à, ÏÇ¨ÎûåÏù¥ Ïó¨Îü¨Î™ÖÏù¥ÎùºÎ©¥ ;ÏúºÎ°ú Íµ¨Î∂ÑÌïúÎã§. (20100000;20102222;20103333)
    prof_id: number | null
    subject: number | null
}

type getDraft = {
    leader_univ_id: number
    new: boolean
    draft_id: number

    pname: string
    pdetails: string
    psize: number
    pperiod: string
    pmm: number
    univ_id: string
    prof_id: number
    subject: number
}

type project = {
    wizard: number //# ÌîÑÎ°úÏ†ùÌä∏ Setup WizardÏùò ÏôÑÎ£å Ïó¨Î∂ÄÎ•º Í∏∞Î°ù

    pname: string  //# ÌîÑÎ°úÏ†ùÌä∏ Ïù¥Î¶Ñ
    pdetails: string  //# ÌîÑÎ°úÏ†ùÌä∏ ÎÇ¥Ïö©
    psize: number  //# ÌîÑÎ°úÏ†ùÌä∏ Í∞úÎ∞ú Ïù∏Ïõê
    pperiod: string  //# ÌîÑÎ°úÏ†ùÌä∏ Í∞úÎ∞ú Í∏∞Í∞Ñ (Ïòà: "241012-241130")
    pmm: number  //# ÌîÑÎ°úÏ†ùÌä∏ Í¥ÄÎ¶¨ Î∞©Î≤ïÎ°† (ÌîÑÎ°úÏ†ùÌä∏ Í¥ÄÎ¶¨ Î∞©Ïãù)
    univ_id: number
    prof_id: number //# Îã¥Îãπ ÍµêÏàòÏùò ÍµêÎ≤à
    subject: number //# Í≥ºÎ™© ÏΩîÎìú
}

type subjectPayload = {
    RESULT_CODE: number,
    RESULT_MSG: string,
    PAYLOAD: {
        Result: subjectType[]
    }
}

type subjectType = {
    subj_no: number
    subj_name: string
}

type draftPayLoad = {
    RESULT_CODE: number
    RESULT_MSG: string
    draft_num: number
    draft_data: {
        draft_id: getDraft[]
    }
}

type dnoPayLoad = {
    RESULT_CODE: number,
    RESULT_MSG: string,
    PAYLOAD: {
        Result: dnoType[]
    }
}

type dnoType = {
    dno: number,
    dname: string
}

type profPayload = {
    RESULT_CODE: number,
    RESULT_MSG: string,
    PAYLOAD: {
        Result: profType[]
    }
}

type profType = {
    f_no: number
    f_name: string
}

type cppList = {
    ver: number;
    date: string;
    s_no: number;
    msg: string;
  };
  
  // Í∏∞Ï°¥ cppList Î∞∞Ïó¥ ÎåÄÏã†, Ïù¥Ï†ú Í∑∏Î£πÎ≥ÑÎ°ú Î∞õÏäµÎãàÎã§.
  type GroupedLog = {
    pname: string | null;
    history: cppList[];
  };

export function EditDraftProjectModal() {
    const [methodDesc, setMethodDesc] = useState('');
    const [isLoading, setIsLoading] = useState(false);
    const [newPj, setNewPj] = useState(true);
    const router = useRouter();
    const [isOpen, setIsOpen] = useState(false);
    const openModal = () => setIsOpen(true);
    const closeModal = () => {
        setIsOpen(false)
        reset()
    };
    
    const [subjectList, setSubjectList] = useState<subjectType[]>([{subj_name: "Loading...", subj_no: 0}])
    const s_no = getUnivId();

    const [projectName, setProjectName] = useState('');
    const [projectDescription, setProjectDescription] = useState('');
    const [startDate, setStartDate] = useState('');
    const [endDate, setEndDate] = useState('');
    const [members, setMembers] = useState(0);
    const [method, setMethod] = useState(0);
    const [profId, setProfId] = useState<number>(99121);
    const [subject, setSubject] = useState(13230);
    const [draftId, setDraftId] = useState(0);
    const [isNew, setIsNew] = useState(true);
    const [profList, setProfList] = useState<profType[]>([{f_no: 0, f_name: "Loading..."}])

    const [draftLoading, setDraftLoading] = useState(true);
    const [recoveryLoading, setRecoveryLoading] = useState(true);

    const [logList, setLogList] = useState<cppList[]>([{
            ver: -1,
            date: "",
            s_no: -1,
            msg: ""
        }]);

    const [selectRecovery, setSelectRecovery] = useState<cppList>({
        ver: -1,
        date: "",
        s_no: -1,
        msg: ""
    })
    const [selectPid, setSelectPid] = useState(0)

    const [draftList, setDraftList] = useState<getDraft[]>([
        {
            leader_univ_id: 0,
            new: false,
            draft_id: 0,
            pname: "Loading...",
            pdetails: '',
            psize: 0,
            pperiod: '',
            pmm: 0,
            univ_id: '',
            prof_id: 0,
            subject: 0,
            
        }
    ]);

    const [page, setPage] = useState(0);

    const [groupedLogs, setGroupedLogs] = useState<Record<number, GroupedLog>>({});
    const [selectedPNo, setSelectedPNo] = useState<number | null>(null);

    const loadRecovery = async () => {
        try {
          // ÏòàÏãú: pidÎäî 0 (ÌòπÏùÄ ÌïÑÏöîÏóê Îî∞Îùº Í∞í Î≥ÄÍ≤Ω)
          const response = await axios.post(
            "https://cd-api.chals.kim/api/ccp/load_history_id",
            { pid: 0, univ_id: s_no, msg: "", ver: 0 },
            { headers: { Authorization: process.env.SECRET_API_KEY } }
          );

          setGroupedLogs(response.data.PAYLOAD);
          setRecoveryLoading(false);
        } catch (err) {
          console.error(err);
          setRecoveryLoading(false);
        }
      };
      useEffect(() => {
        switch (method) {
            case 0:
                setMethodDesc("üìò Ìè≠Ìè¨Ïàò Î™®Îç∏: Îã®Í≥ÑÎ≥ÑÎ°ú ÏàúÏ∞®Ï†ÅÏúºÎ°ú Í∞úÎ∞úÌïòÎäî Ï†ÑÌÜµÏ†ÅÏù∏ Í∞úÎ∞ú Î∞©ÏãùÏûÖÎãàÎã§. Î≥ÄÍ≤ΩÏóê Ï∑®ÏïΩÌïòÏßÄÎßå Í≥ÑÌöçÏóê Ï∂©Ïã§Ìï©ÎãàÎã§.");
                break;
            case 1:
                setMethodDesc("üöÄ Ïï†ÏûêÏùº Î™®Îç∏: Îπ†Î•∏ ÌîºÎìúÎ∞±Í≥º Ïú†Ïó∞Ìïú Í∞úÎ∞úÏùÑ ÏßÄÌñ•ÌïòÎäî Î∞©ÏãùÏúºÎ°ú Î∞òÎ≥µÏ†ÅÏúºÎ°ú Í∞úÏÑ†Ìï©ÎãàÎã§.");
                break;
            case 2:
                setMethodDesc("‚öôÔ∏è Í∏∞ÌÉÄ: ÌåÄÏóê ÎßûÎäî ÏûêÏ≤¥ Í∞úÎ∞ú Î∞©ÏãùÏùÑ ÏÇ¨Ïö©ÌïòÍ±∞ÎÇò ÏúÑ Îëê Í∞ÄÏßÄ Ïô∏Ïùò Î∞©ÏãùÏùÑ ÏÑ†ÌÉùÌï©ÎãàÎã§.");
                break;
            default:
                setMethodDesc('');
        }
    }, [method]);
    
    // useEffect(() => {
    //     const groups = logList.reduce((acc: Record<number, cppList[]>, log) => {
    //         if (!acc[log.p_no]) {
    //         acc[log.p_no] = [];
    //         }
    //         acc[log.p_no].push(log);
    //         return acc;
    //     }, {});
    //     setGroupedLogs(groups);
    // }, [logList]);

    const handleGroupClick = (p_no: number) => {
        setSelectedPNo(selectedPNo === p_no ? null : p_no);
      };

    useEffect(() => {
        if(isOpen){
            loadSubject();
            loadDraft();
            loadRecovery();
        }
    }, [isOpen])

    // const loadRecovery = async() => {
    //     try{
    //         const response = await axios.post("https://cd-api.chals.kim/api/ccp/load_history_id", {pid: 0, univ_id: s_no, msg: "", ver: 0}, {headers:{Authorization: process.env.SECRET_API_KEY}});
    //         setLogList(response.data.PAYLOAD)
    //         setRecoveryLoding(false);
    //     }catch(err){}
    // }

    const handleSubmit = (e: React.FormEvent) => {
        e.preventDefault();
        if (projectName.trim() === "" || projectDescription.trim() === '' || startDate === '' || endDate === '') {
            alert("Í∞íÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");
        }else{
            postInit()
            reset()
            closeModal()
        }
        
    };

    const reset = () => {
        setProjectName('');
        setProjectDescription('');
        setStartDate('');
        setEndDate('');
        setMembers(0);
        setMethod(0);
        setSubject(13230)
        setProfId(0)
        setPage(0)
        setDraftList([])
        setNewPj(true)
    }

    const reset2 = () => { // ÏÉà ÌîÑÎ°úÏ†ùÌä∏ ÌÅ¥Î¶≠ Ïãú Î¶¨ÏÖã
        setProjectName('');
        setProjectDescription('');
        setStartDate('');
        setEndDate('');
        setMembers(0);
        setMethod(0);
        setSubject(13230)
        setProfId(0)
        setPage(0)
        setIsNew(true)
        // setDraftList([])
        setNewPj(true)
    }

    const loadProf = async() => {
        try{
            const response = await axios.post<profPayload>("https://cd-api.chals.kim/api/acc/load_prof", {subj_no: subject}, {headers:{Authorization: process.env.SECRET_API_KEY}});
            setProfList(response.data.PAYLOAD.Result)
        }catch(err){}
    }

    useEffect(() => {
        loadProf()
    }, [subject])

    useEffect(() => {
        if(profList.length > 0){
            setProfId(profList[0].f_no)
        }else{
            setProfId(0)
        }
    }, [profList])

    const loadSubject = async() => {
        try{
            const response = await axios.post<subjectPayload>("https://cd-api.chals.kim/api/subject/load_all", {}, {headers:{Authorization: process.env.SECRET_API_KEY}});
            
            const result = response.data.PAYLOAD.Result;
            setSubjectList(Array.isArray(result) ? result : []);
        }catch(err){}
    }

    

    const loadDraft = async() => {
        const postDraft: draft = {
            leader_univ_id: s_no,
            new: false,
            draft_id: 0,

            pname: 'a',
            pdetails: 'a',
            psize: 0,
            pperiod: `a`,
            pmm: 0,
            univ_id: '',
            prof_id: 0,
            subject: 0
        }
        try{
            const response = await axios.post<draftPayLoad>("https://cd-api.chals.kim/api/project/load_draft", postDraft, {headers:{Authorization: process.env.SECRET_API_KEY}});
            const tmp = response.data.draft_data.draft_id;
            setDraftList(Object.values(tmp));
            setDraftLoading(false)
        }catch(err){}
    }

    const postDraft = async() => {
        const postDraft: draft = {
            leader_univ_id: s_no,
            new: isNew,
            draft_id: draftId,
            pname: projectName,
            pdetails: projectDescription,
            psize: members,
            pperiod: `${fixDate(startDate)}-${fixDate(endDate)}`,
            pmm: method,
            univ_id: '',
            prof_id: profId,
            subject: subject
        }
        try{
            const response = await axios.post("https://cd-api.chals.kim/api/project/save_draft", postDraft, {headers:{Authorization: process.env.SECRET_API_KEY}});
            closeModal()
        }catch(err){
        }
    }

    const postInit = async() => {
        const postInit: project = {
            wizard: 0,
            pname: projectName,
            pdetails: projectDescription,
            psize: 0,
            pperiod: `${fixDate(startDate)}-${fixDate(endDate)}`,
            pmm: method,
            univ_id: s_no,
            prof_id: profId,
            subject: subject
        }

        const postDraft: draft = {
            leader_univ_id: s_no,
            new: false,
            draft_id: draftId,
            pname: projectName,
            pdetails: projectDescription,
            psize: members,
            pperiod: `${fixDate(startDate)}-${fixDate(endDate)}`,
            pmm: method,
            univ_id: '',
            prof_id: profId,
            subject: subject
        }

        try{
            const response = await axios.post("https://cd-api.chals.kim/api/project/init", postInit, {headers:{Authorization: process.env.SECRET_API_KEY}});
            const response3 = await axios.post("https://cd-api.chals.kim/api/pm/add_leader", {pid: response.data.PAYLOADS.PUID, univ_id: s_no}, {headers:{Authorization: process.env.SECRET_API_KEY}});
            if (response.data.RESULT_CODE === 200) {
                router.push(`/project-main/${response.data.PAYLOADS.PUID}`);
                const response2 = await axios.post("https://cd-api.chals.kim/api/project/del_draft", postDraft, {headers:{Authorization: process.env.SECRET_API_KEY}});
            };
        }catch(err){}
    }

    const fixDate = (date: string) => {
        const rawValue = date;
        const formatted = rawValue.replace(/-/g, "").slice(2);
        return formatted;
    };

    const handlePageUp = () => {
        if(page < 3){
            const tmpPage = page;
            setPage(tmpPage + 1)
        }
    }

    const handlePageDown = () => {
        if(page > 0){
            const tmpPage = page;
            setPage(tmpPage - 1)
        }
    }

    const handleRecoveryClick = () => {
        setPage(-1)
    }

    const handleDraftClick = (item: getDraft, index: number) => {
        if(item.pperiod === "-"){
            setStartDate('');
            setEndDate('');
        }else{
            const [sStr = "", eStr = ""] = item.pperiod.split("-");
            let sDate = "";
            let eDate = "";

            if(sStr && sStr.length === 6){
                sDate = `20${sStr.slice(0,2)}-${sStr.slice(2,4)}-${sStr.slice(4,6)}`
                setStartDate(sDate)
            }
            if(eStr && eStr.length === 6){
                eDate = `20${eStr.slice(0,2)}-${eStr.slice(2,4)}-${eStr.slice(4,6)}`
                setEndDate(eDate)
            }
        }
        setProjectName(item.pname);
        setProjectDescription(item.pdetails);
        setIsNew(false)
        setMethod(item.pmm);
        setSubject(item.subject)
        setProfId(item.prof_id)
        setDraftId(index)
        setNewPj(false)
        setPage(1)
    }

    const handleNewPJClick = () => {
        reset2();
        setPage(1);
    }

    const handlereturnPJClick = () => {
        alert("Ï§ÄÎπÑÏ§ëÏûÖÎãàÎã§.")
    }

    const handleFirstPage = () => {
        setPage(0)
    }

    const handleCppClick = (item: cppList) => {
        setSelectRecovery(item)
        setPage(-2)
    }

    const handleImport = async() => {
            if(isLoading) return
            setIsLoading(true)
            const data = {
                pid: selectPid,
                univ_id: selectRecovery.s_no,
                msg: selectRecovery.msg,
                ver: selectRecovery.ver,
                is_removed: 1
            }
            try{
                    const response = await axios.post("https://cd-api.chals.kim/api/ccp/import", data, {headers:{Authorization: process.env.SECRET_API_KEY}});
                    closeModal()
                    alert("Í∞ÄÏ†∏Ïò§Í∏∞ ÏôÑÎ£å!")
                    router.push(`/project-main/${selectPid}/main`)
            }catch(err){
    
            }finally{
                setIsLoading(false)
            }
        }

    return (
        <div>
            <button onClick={openModal} style={{ 
                position: 'relative', 
                // bottom: '25px', 
                // left: '20px', 
                backgroundColor: '#007bff', 
                color: '#fff', 
                minWidth: "130px",
                height: "36px",
                border: "1px solid #d1d5db",
                borderRadius: "12px 12px 0 0",
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                cursor: "pointer",
                flex: "0 0 auto",
                padding: "0 12px",
                transition: "all 0.3s ease-in-out",
                boxShadow: "0px 2px 4px rgba(0, 0, 0, 0.1)",
            }}>
                ÏÉàÎ°úÏö¥ ÌîÑÎ°úÏ†ùÌä∏
            </button>
            <Modal isOpen={isOpen} closeModal={closeModal}>
                {(() => {
                    switch (page){
                        case 0:
                            return (
                                <div style={{width: '100%', height: '100%',marginBottom: '15px', overflowY: 'auto', maxHeight: '500px'}}>
                                    <h2 style={{ textAlign: 'center', marginBottom: '20px', fontWeight: 'bold', color: '#333' }}>ÏûÑÏãú ÌîÑÎ°úÏ†ùÌä∏ Î¶¨Ïä§Ìä∏</h2>
                                    {(draftLoading) ? (
                                        <div style={{width: '100%', height: '300px',maxHeight: '300px', overflowY: 'auto'}}>
                                            
                                        </div>
                                        ) : (
                                        <div style={{width: '100%', height: '300px',maxHeight: '300px', overflowY: 'auto'}}>
                                            {draftList.map((item: getDraft, index: number) => (
                                                <div key={index} style={{width: 'calc(80%)', padding: '5px', margin: 'auto'}}>
                                                    <button onClick={() => handleDraftClick(item, index)} style={{border: '1px solid #000', borderRadius: '8px', padding: '5px', width: '100%', backgroundColor: '#fff'}}>
                                                        <span style={{fontSize: '18px'}}>{index+1}: {item.pname}</span>
                                                    </button>
                                                </div>
                                            ))}
                                        </div>)}
                                    <div style={{width: 'calc(80%)', padding: '5px', margin: 'auto'}}>
                                        <button onClick={handleNewPJClick} style={{border: '1px solid #000', borderRadius: '8px', padding: '5px', width: '100%', backgroundColor: '#fff'}}>
                                            <span style={{fontSize: '18px'}}>ÏÉàÎ°úÏö¥ ÌîÑÎ°úÏ†ùÌä∏ ÏÉùÏÑ±</span>
                                        </button>
                                    </div>
                                    <div style={{width: 'calc(80%)', padding: '5px', margin: 'auto'}}>
                                        <button onClick={handleRecoveryClick} style={{border: '1px solid #000', borderRadius: '8px', padding: '5px', width: '100%', backgroundColor: '#fff'}}>
                                            <span style={{fontSize: '18px'}}>ÌîÑÎ°úÏ†ùÌä∏ Î≥µÏõê</span>
                                        </button>
                                    </div>
                                </div>
                            )
                        case 1:
                            return (
                                <form onSubmit={handleSubmit} onKeyDown={(e) => {if (e.key === "Enter"){e.preventDefault();}}} style={{ padding: '30px', borderRadius: '12px', backgroundColor: '#ffffff' }}>
                                {newPj?(<h2>ÏÉàÎ°úÏö¥ ÌîÑÎ°úÏ†ùÌä∏</h2>):(<h2 style={{ textAlign: 'center', marginBottom: '20px', fontWeight: 'bold', color: '#333' }}>ÌîÑÎ°úÏ†ùÌä∏ Í∞úÏÑ§</h2>)}
                                <div style={{ marginBottom: '15px' }}>
    <label htmlFor="projectName" style={{ fontWeight: 'bold', marginBottom: '5px', display: 'block' }}>ÌîÑÎ°úÏ†ùÌä∏ Ïù¥Î¶Ñ:</label>
    <input
        type="text"
        id="projectName"
        value={projectName}
        onChange={(e) => setProjectName(e.target.value)}
        required
        style={{ width: '100%', padding: '10px', borderRadius: '6px', border: '1px solid #ddd' }}
    />
    <p style={{ fontSize: '13px', color: '#777', marginTop: '5px' }}>
        ex) Ïä§ÎßàÌä∏Ìåú IoT Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú, AI Ï±óÎ¥á Í∞úÎ∞ú Îì±. Î™ÖÌôïÌïòÍ≥† Íµ¨Ï≤¥Ï†ÅÏù∏ Ïù¥Î¶ÑÏùÑ ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.
    </p>
</div>

<div style={{ marginBottom: '15px' }}>
    <label htmlFor="projectDescription" style={{ fontWeight: 'bold', marginBottom: '5px', display: 'block' }}>ÌîÑÎ°úÏ†ùÌä∏ ÏÑ§Î™Ö:</label>
    <textarea
        id="projectDescription"
        value={projectDescription}
        onChange={(e) => setProjectDescription(e.target.value)}
        style={{ width: '100%', padding: '10px', borderRadius: '6px', border: '1px solid #ddd', resize: 'vertical' }}
    ></textarea>
    <p style={{ fontSize: '13px', color: '#777', marginTop: '5px' }}>
        ÌîÑÎ°úÏ†ùÌä∏ Î™©Ìëú, Ï£ºÏöî Í∏∞Îä•, Í∏∞ÎåÄ Ìö®Í≥º Îì±ÏùÑ Í∞ÑÎã®Ìûà ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî. (3~5Ï§Ñ Í∂åÏû•)
    </p>
</div>

<div style={{ marginBottom: '15px' }}>
    <label htmlFor="startDate" style={{ fontWeight: 'bold', marginBottom: '5px', display: 'block' }}>ÏãúÏûëÏùº:</label>
    <input
        type="date"
        id="startDate"
        value={startDate}
        onChange={(e) => setStartDate(e.target.value)}
        style={{ width: '100%', padding: '10px', borderRadius: '6px', border: '1px solid #ddd' }}
    />
    <p style={{ fontSize: '13px', color: '#777', marginTop: '5px' }}>
        ÌîÑÎ°úÏ†ùÌä∏ ÏãúÏûë ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî. (Ïòà: 2024-05-01)
    </p>
</div>

<div style={{ marginBottom: '15px' }}>
    <label htmlFor="endDate" style={{ fontWeight: 'bold', marginBottom: '5px', display: 'block' }}>ÎßàÍ∞êÏùº:</label>
    <input
        type="date"
        id="endDate"
        value={endDate}
        onChange={(e) => setEndDate(e.target.value)}
        style={{ width: '100%', padding: '10px', borderRadius: '6px', border: '1px solid #ddd' }}
    />
    <p style={{ fontSize: '13px', color: '#777', marginTop: '5px' }}>
        ÌîÑÎ°úÏ†ùÌä∏ ÏµúÏ¢Ö Ï†úÏ∂ú ÏòàÏ†ïÏùºÏùÑ ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî. (Ïòà: 2024-07-15)
    </p>
</div>

                                <div style={{width: '100%', display: 'flex'}}>
                                    <button type="button" onClick={postDraft} style={{ padding: '5px', backgroundColor: '#28a745', color: '#fff', border: 'none', borderRadius: '8px', cursor: 'pointer', width: 'auto', fontWeight: 'bold' }}>ÏûÑÏãú Ï†ÄÏû•</button>
                                    <button type="button" onClick={handlePageDown} style={{ padding: '5px', marginLeft: 'auto', marginRight: '0px', backgroundColor: '#28a745', color: '#fff', border: 'none', borderRadius: '8px', cursor: 'pointer', width: 'auto', fontWeight: 'bold' }}>Ïù¥Ï†Ñ ÌéòÏù¥ÏßÄ</button>
                                    <button type="button" onClick={handlePageUp} style={{ padding: '5px', backgroundColor: '#28a745', color: '#fff', border: 'none', borderRadius: '8px', cursor: 'pointer', width: 'auto', fontWeight: 'bold' }}>Îã§Ïùå ÌéòÏù¥ÏßÄ</button>
                                </div>
                            </form>
                        )
                        case 2:
                            return (
                                <div>
                                    <form onSubmit={handleSubmit} onKeyDown={(e) => {if (e.key === "Enter"){e.preventDefault();}}} style={{ padding: '30px', borderRadius: '12px', backgroundColor: '#ffffff' }}>
                                        <h2 style={{ textAlign: 'center', marginBottom: '20px', fontWeight: 'bold', color: '#333' }}>ÌîÑÎ°úÏ†ùÌä∏ Í∞úÏÑ§</h2>
                                        <div style={{ marginBottom: '15px' }}>
                                            <label htmlFor="members" style={{ fontWeight: 'bold', marginBottom: '5px', display: 'block' }}>Í≥ºÎ™©:</label>
                                            <select
                                                value={subject}
                                                onChange={(e) => setSubject(Number(e.target.value))}
                                                style={{ width: 'calc(100% + 24px)', padding: '10px', borderRadius: '6px', border: '1px solid #ddd', backgroundColor: '#ffffff' }}
                                            >
                                                {Array.isArray(subjectList) &&
                                                    subjectList.map((tmp) => (
                                                        <option key={tmp.subj_no} value={tmp.subj_no}>
                                                            {tmp.subj_name}
                                                        </option>
                                                    ))
                                                }
                                            </select>
                                        </div>
                                        <div style={{ marginBottom: '15px' }}>
                                            <label htmlFor="members" style={{ fontWeight: 'bold', marginBottom: '5px', display: 'block' }}>ÍµêÏàò Î≤àÌò∏:</label>
                                            <select
                                                value={profId}
                                                onChange={(e) => setProfId(Number(e.target.value))}
                                                style={{ width: 'calc(100% + 24px)', padding: '10px', borderRadius: '6px', border: '1px solid #ddd', backgroundColor: '#ffffff' }}
                                            >
                                                {Array.isArray(profList) &&
                                                    profList.map((item) => (
                                                        <option key={item.f_no} value={item.f_no}>
                                                            {item.f_name}
                                                        </option>
                                                    ))
                                                }
                                            </select>
                                        </div>
                                        
                                        <div style={{width: '100%', display: 'flex'}}>
                                            <button type="button" onClick={postDraft} style={{ padding: '5px', backgroundColor: '#28a745', color: '#fff', border: 'none', borderRadius: '8px', cursor: 'pointer', width: 'auto', fontWeight: 'bold' }}>ÏûÑÏãú Ï†ÄÏû•</button>
                                            <button type="button" onClick={handlePageDown} style={{ padding: '5px', marginLeft: 'auto', marginRight: '0px', backgroundColor: '#28a745', color: '#fff', border: 'none', borderRadius: '8px', cursor: 'pointer', width: 'auto', fontWeight: 'bold' }}>Ïù¥Ï†Ñ ÌéòÏù¥ÏßÄ</button>
                                            <button type="button" onClick={handlePageUp} style={{ padding: '5px', backgroundColor: '#28a745', color: '#fff', border: 'none', borderRadius: '8px', cursor: 'pointer', width: 'auto', fontWeight: 'bold' }}>Îã§Ïùå ÌéòÏù¥ÏßÄ</button>
                                        </div>
                                    </form>
                                </div>
                                
                            )
                        case 3:
                            return (
                                <div>
                                    <form onSubmit={handleSubmit} onKeyDown={(e) => {if (e.key === "Enter"){e.preventDefault();}}} style={{ padding: '30px', borderRadius: '12px', backgroundColor: '#ffffff' }}>
                                        <h2 style={{ textAlign: 'center', marginBottom: '20px', fontWeight: 'bold', color: '#333' }}>ÌîÑÎ°úÏ†ùÌä∏ Í∞úÏÑ§</h2>
                                        <div style={{ marginBottom: '15px' }}>
                                            <label htmlFor="method" style={{ fontWeight: 'bold', marginBottom: '5px', display: 'block' }}>Í∞úÎ∞ú Î∞©Ïãù:</label>
                                            <select
                                                value={method}
                                                onChange={(e) => setMethod(Number(e.target.value))}
                                                style={{ width: 'calc(100% + 24px)', padding: '10px', borderRadius: '6px', border: '1px solid #ddd', backgroundColor: '#ffffff' }}
                                            >
                                                <option value={0}>Ìè≠Ìè¨Ïàò Î™®Îç∏</option>
                                                <option value={1}>ÏóêÏûêÏùº Î™®Îç∏</option>
                                                <option value={2}>Í∏∞ÌÉÄ</option>
                                            </select>
                                           
{methodDesc && (
  <div style={{ marginTop: '10px', fontSize: '14px', color: '#555', background: '#f9f9f9', padding: '10px 12px', borderRadius: '8px' }}>
    {methodDesc}
  </div>
)}

{/* Í∞úÎ∞ú Î∞©Ïãù ÏÑ†ÌÉùÏóê Îî∞Îùº ÏòàÏãú Ïù¥ÎØ∏ÏßÄ Ï∂úÎ†• */}
{method === 0 && (
  <div style={{ marginTop: '20px', textAlign: 'center' }}>
    <Image
      src={waterfallImg}
      alt="Ìè≠Ìè¨Ïàò Î™®Îç∏ ÏòàÏãú"
      layout="responsive"
      width={500}
      height={300}
      style={{ objectFit: 'contain', borderRadius: '8px', marginTop: '10px' }}
    />
    <div style={{ marginTop: '5px', fontSize: '13px', color: '#777' }}>Ìè≠Ìè¨Ïàò Î™®Îç∏ ÏòàÏãú</div>
  </div>
)}

{method === 1 && (
  <div style={{ marginTop: '20px', textAlign: 'center' }}>
    <Image
      src={agileImg}
      alt="Ïï†ÏûêÏùº Î™®Îç∏ ÏòàÏãú"
      layout="responsive"
      width={500}
      height={300}
      style={{ objectFit: 'contain', borderRadius: '8px', marginTop: '10px' }}
    />
    <div style={{ marginTop: '5px', fontSize: '13px', color: '#777' }}>Ïï†ÏûêÏùº Î™®Îç∏ ÏòàÏãú</div>
  </div>
)}



                                        </div>
                                        <div style={{width: '100%', display: 'flex'}}>
                                            <button type="button" onClick={postDraft} style={{ padding: '5px', backgroundColor: '#28a745', color: '#fff', border: 'none', borderRadius: '8px', cursor: 'pointer', width: 'auto', fontWeight: 'bold' }}>ÏûÑÏãú Ï†ÄÏû•</button>
                                            <button type="button" onClick={handlePageDown} style={{ padding: '5px', marginLeft: 'auto', backgroundColor: '#28a745', color: '#fff', border: 'none', borderRadius: '8px', cursor: 'pointer', width: 'auto', fontWeight: 'bold' }}>Ïù¥Ï†Ñ ÌéòÏù¥ÏßÄ</button>
                                            <button type="submit" style={{ padding: '5px', backgroundColor: '#28a745', color: '#fff', border: 'none', borderRadius: '8px', cursor: 'pointer', width: 'auto', fontWeight: 'bold' }}>Ï†ÄÏû•</button>
                                        </div>
                                    </form>
                                </div>
                            )
                        case -1:
                            return(
                                <div style={{width: '100%', height: '100%',marginBottom: '15px', overflowY: 'auto', maxHeight: '500px'}}>
                                    <h2 style={{ textAlign: 'center', marginBottom: '20px', fontWeight: 'bold', color: '#333' }}>ÏÇ≠Ï†úÎêú ÌîÑÎ°úÏ†ùÌä∏ Î¶¨Ïä§Ìä∏</h2>
                                    {(recoveryLoading) ? (
                                        <div style={{width: '100%', height: '300px',maxHeight: '300px', overflowY: 'auto'}}>
                                            
                                        </div>
                                        ) : (
                                        <div style={{width: '100%', height: '300px',maxHeight: '300px', overflowY: 'auto'}}>
                                            {recoveryLoading ? (
                                                <div>Loading...</div>
                                            ) : (
                                                Object.keys(groupedLogs).map((p_noStr) => {
                                                const p_no = parseInt(p_noStr);
                                                const group = groupedLogs[p_no];
                                                return (
                                                    <div key={p_no} style={{ marginBottom: "10px", width: "80%", margin: "auto" }}>
                                                    {/* Í∑∏Î£π Î≤ÑÌäº */}
                                                    <button
                                                        onClick={() => handleGroupClick(p_no)}
                                                        style={{
                                                        width: "100%",
                                                        padding: "10px",
                                                        border: "1px solid #000",
                                                        borderRadius: "8px",
                                                        backgroundColor: "#fff",
                                                        cursor: "pointer",
                                                        textAlign: "left",
                                                        }}
                                                    >
                                                        {`${group.pname}: (${group.history.length} Í∞ú Î°úÍ∑∏)`}
                                                    </button>
                                                    {/* ÏÑ†ÌÉùÎêú Í∑∏Î£πÏù¥Î©¥ Ìï¥Îãπ Í∑∏Î£πÏùò Î°úÍ∑∏ ÎÇòÏó¥ */}
                                                    {selectedPNo === p_no && (
                                                        <div style={{ marginTop: "5px", margin: "10px" }}>
                                                        {group.history.map((item, index) => (
                                                            <div key={index} style={{ marginBottom: "5px" }}>
                                                            <button
                                                                onClick={() => handleCppClick(item)}
                                                                style={{
                                                                width: "100%",
                                                                padding: "8px",
                                                                border: "1px solid #000",
                                                                borderRadius: "8px",
                                                                backgroundColor: "#fff",
                                                                cursor: "pointer",
                                                                }}
                                                            >
                                                                <span>{`ver.${item.ver} | ${item.msg}`}</span>
                                                                <br />
                                                                <span>{item.date.replace("T", " ")}</span>
                                                            </button>
                                                            </div>
                                                        ))}
                                                        </div>
                                                    )}
                                                    </div>
                                                );
                                                })
                                            )}
                                        </div>)}
                                    <div style={{width: 'calc(80%)', padding: '5px', margin: 'auto'}}>
                                        <button onClick={handlePageUp} style={{border: '1px solid #000', borderRadius: '8px', padding: '5px', width: '100%', backgroundColor: '#fff'}}>
                                            <span style={{fontSize: '18px'}}>Ï≤´ ÌéòÏù¥ÏßÄ Ïù¥Îèô</span>
                                        </button>
                                    </div>
                                </div>
                            )
                        case -2:
                            return (
                                <div style={{width: '100%', height: '100%',marginBottom: '15px', overflowY: 'auto', maxHeight: '500px'}}>
                                    <h2 style={{ textAlign: 'center', marginBottom: '20px', fontWeight: 'bold', color: '#333' }}>ÌîÑÎ°úÏ†ùÌä∏ Ï†ïÎ≥¥</h2>
                                    <div style={{ display: "flex", flexDirection: "column", width: '80%', margin: '20px auto' }}>
                                                            <div style={modalFieldStyle}>
                                                                <strong>Î≤ÑÏ†Ñ: </strong>
                                                                {selectRecovery.ver}
                                                            </div>
                                                            <div style={modalFieldStyle}>
                                                                <strong>ÏàòÏ†ïÏûê: </strong>
                                                                {selectRecovery.s_no}
                                                            </div>
                                                            <div style={modalFieldStyle}>
                                                                <strong>ÏàòÏ†ï ÎÇ†Ïßú: </strong>
                                                                {selectRecovery.date.replace("T", " ")}
                                                            </div>
                                                            <div style={modalFieldStyle}>
                                                                <strong>ÏàòÏ†ï ÏÇ¨Ìï≠: </strong>
                                                                {selectRecovery.msg}
                                                            </div>
                                                        </div>
                                    <div style={{width: 'calc(80%)', padding: '5px', margin: 'auto'}}>
                                        <button onClick={handleImport} disabled={isLoading} style={{border: '1px solid #000', borderRadius: '8px', padding: '5px', width: '100%', backgroundColor: '#fff'}}>
                                            <span style={{fontSize: '18px'}}>Î≥µÏõêÌïòÍ∏∞</span>
                                        </button>
                                    </div>
                                    <div style={{width: 'calc(80%)', padding: '5px', margin: 'auto'}}>
                                        <button onClick={handlePageUp} style={{border: '1px solid #000', borderRadius: '8px', padding: '5px', width: '100%', backgroundColor: '#fff'}}>
                                            <span style={{fontSize: '18px'}}>Ïù¥Ï†Ñ ÌéòÏù¥ÏßÄ</span>
                                        </button>
                                    </div>
                                    <div style={{width: 'calc(80%)', padding: '5px', margin: 'auto'}}>
                                        <button onClick={handleFirstPage} style={{border: '1px solid #000', borderRadius: '8px', padding: '5px', width: '100%', backgroundColor: '#fff'}}>
                                            <span style={{fontSize: '18px'}}>Ï≤´ ÌéòÏù¥ÏßÄ Ïù¥Îèô</span>
                                        </button>
                                    </div>
                                </div>
                            )
                        default:
                            return (
                                <div>
                                    Loading...
                                </div>
                            );
                    }
                })()}
            
            </Modal>
        </div>
    )
}

const modalFieldStyle: CSSProperties = {
    marginBottom: "10px",
    fontSize: "16px",
  };